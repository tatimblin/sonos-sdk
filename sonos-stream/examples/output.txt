ğŸµ Sonos SDK Example: Discover and Stream Events
================================================

ğŸ“¡ Setting up event streaming...
ğŸŒ Unified CallbackServer listening on 0.0.0.0:3400 - ready to process events from all speakers and services
ğŸš€ Enhanced Firewall Detection Plugin: Starting initialization
ğŸ” Enhanced Firewall Detection: Starting UPnP-based detection
ğŸ” UPnP device discovery not yet implemented - using empty device list
âš ï¸  No UPnP devices found for testing
ğŸ”„ Falling back to basic detection
ğŸ” Basic Firewall Detection: Testing connectivity to http://192.168.4.34:3400/firewall-test
âš ï¸  Note: This only tests local connectivity. Real firewall blocking may still occur for external UPnP devices.
ğŸ¯ Firewall Test Endpoint: Received test request
âœ… Basic Detection: Local server is accessible (status: 200 OK)
âš ï¸  This doesn't guarantee UPnP events from network devices will work
ğŸ”„ Firewall Detection: Status updated to Unknown
âœ… Enhanced Firewall Detection Plugin: Initialization completed with status Unknown
âœ… Plugin 'firewall-detection' initialized successfully
ğŸ”„ CallbackAdapter: Starting unified event processing task
âœ… Event broker ready, callback URL: http://192.168.4.34:3400

ğŸ” Discovering Sonos speakers...
This may take up to 10 seconds...
âœ… Found 8 Sonos speaker(s):
   ğŸ“» 192.168.4.49 - Sonos Playbar - RINCON_5CAAFDAE58BD01400 (Basement) at 192.168.4.49
   ğŸ“» 192.168.4.45 - Sonos Connect:Amp - RINCON_B8E937A84F0601400 (Bathroom) at 192.168.4.45
   ğŸ“» 192.168.4.54 - Sonos Roam 2 - RINCON_C43875CA135801400 (Office / Roam) at 192.168.4.54
   ğŸ“» 192.168.4.44 - Sonos Connect:Amp - RINCON_000E583FEE3401400 (Kitchen) at 192.168.4.44
   ğŸ“» 192.168.4.46 - Sonos Connect:Amp - RINCON_5CAAFDEFEE7E01400 (Bedroom) at 192.168.4.46
   ğŸ“» 192.168.4.47 - Sonos One - RINCON_7828CAFB9D9C01400 (Basement) at 192.168.4.47
   ğŸ“» 192.168.4.48 - Sonos One - RINCON_7828CA128F0001400 (Basement) at 192.168.4.48
   ğŸ“» 192.168.4.43 - Sonos Amp - RINCON_804AF2AA2FA201400 (Living Room) at 192.168.4.43

ğŸ”— Creating subscriptions for AVTransport service...
âœ… Subscribed to 192.168.4.49 - Sonos Playbar - RINCON_5CAAFDAE58BD01400 (192.168.4.49)
ğŸ“ CallbackAdapter: Registered subscription uuid:RINCON_5CAAFDAE58BD01400_sub0000000085 for speaker RINCON_5CAAFDAE58BD01400 service AVTransport
ğŸ“ Registered subscription uuid:RINCON_5CAAFDAE58BD01400_sub0000000085 for speaker 192.168.4.49 - Sonos Playbar - RINCON_5CAAFDAE58BD01400

ğŸŒ === UNIFIED CALLBACK SERVER: INCOMING NOTIFY ===
ğŸ“¡ Method: NOTIFY
ğŸ“¡ Path: /
ğŸ“ Body size: 2133 bytes
ğŸ“‹ Headers:
   SID: uuid:RINCON_5CAAFDAE58BD01400_sub0000000085
   NT: upnp:event
   NTS: upnp:propchange
ğŸ“„ Event XML (first 200 chars):
<e:propertyset xmlns:e="urn:schemas-upnp-org:event-1-0"><e:property><LastChange>&lt;Event xmlns=&quot;urn:schemas-upnp-org:metadata-1-0/AVT/&quot; xmlns:r=&quot;urn:schemas-rinconnetworks-com:metadata...
ğŸŒ === END UNIFIED CALLBACK NOTIFICATION ===

âŒ Unified event stream: Event routing failed - subscription not found
âœ… Subscribed to 192.168.4.45 - Sonos Connect:Amp - RINCON_B8E937A84F0601400 (192.168.4.45)
ğŸ“ CallbackAdapter: Registered subscription uuid:RINCON_B8E937A84F0601400_sub0000000234 for speaker RINCON_B8E937A84F0601400 service AVTransport
ğŸ“ Registered subscription uuid:RINCON_B8E937A84F0601400_sub0000000234 for speaker 192.168.4.45 - Sonos Connect:Amp - RINCON_B8E937A84F0601400

ğŸŒ === UNIFIED CALLBACK SERVER: INCOMING NOTIFY ===
ğŸ“¡ Method: NOTIFY
ğŸ“¡ Path: /
ğŸ“ Body size: 2133 bytes
ğŸ“‹ Headers:
   SID: uuid:RINCON_B8E937A84F0601400_sub0000000234
   NT: upnp:event
   NTS: upnp:propchange
ğŸ“„ Event XML (first 200 chars):
<e:propertyset xmlns:e="urn:schemas-upnp-org:event-1-0"><e:property><LastChange>&lt;Event xmlns=&quot;urn:schemas-upnp-org:metadata-1-0/AVT/&quot; xmlns:r=&quot;urn:schemas-rinconnetworks-com:metadata...
ğŸŒ === END UNIFIED CALLBACK NOTIFICATION ===

âŒ Unified event stream: Event routing failed - subscription not found
âœ… Subscribed to 192.168.4.54 - Sonos Roam 2 - RINCON_C43875CA135801400 (192.168.4.54)
ğŸ“ CallbackAdapter: Registered subscription uuid:RINCON_C43875CA135801400_sub0000000156 for speaker RINCON_C43875CA135801400 service AVTransport
ğŸ“ Registered subscription uuid:RINCON_C43875CA135801400_sub0000000156 for speaker 192.168.4.54 - Sonos Roam 2 - RINCON_C43875CA135801400

ğŸŒ === UNIFIED CALLBACK SERVER: INCOMING NOTIFY ===
âœ… Subscribed to 192.168.4.44 - Sonos Connect:Amp - RINCON_000E583FEE3401400 (192.168.4.44)
ğŸ“¡ Method: NOTIFY
ğŸ“¡ Path: /
ğŸ“ Body size: 6163 bytes
ğŸ“‹ Headers:
   SID: uuid:RINCON_C43875CA135801400_sub0000000156
   NT: upnp:event
   NTS: upnp:propchange
ğŸ“ CallbackAdapter: Registered subscription uuid:RINCON_000E583FEE3401400_sub0000000230 for speaker RINCON_000E583FEE3401400 service AVTransport
ğŸ“„ Event XML (first 200 chars):
ğŸ“ Registered subscription uuid:RINCON_000E583FEE3401400_sub0000000230 for speaker 192.168.4.44 - Sonos Connect:Amp - RINCON_000E583FEE3401400
<e:propertyset xmlns:e="urn:schemas-upnp-org:event-1-0"><e:property><LastChange>&lt;Event xmlns=&quot;urn:schemas-upnp-org:metadata-1-0/AVT/&quot; xmlns:r=&quot;urn:schemas-rinconnetworks-com:metadata...
ğŸŒ === END UNIFIED CALLBACK NOTIFICATION ===

âŒ Unified event stream: Event routing failed - subscription not found

ğŸŒ === UNIFIED CALLBACK SERVER: INCOMING NOTIFY ===
ğŸ“¡ Method: NOTIFY
ğŸ“¡ Path: /
ğŸ“ Body size: 2133 bytes
ğŸ“‹ Headers:
   SID: uuid:RINCON_000E583FEE3401400_sub0000000230
   NT: upnp:event
   NTS: upnp:propchange
ğŸ“„ Event XML (first 200 chars):
<e:propertyset xmlns:e="urn:schemas-upnp-org:event-1-0"><e:property><LastChange>&lt;Event xmlns=&quot;urn:schemas-upnp-org:metadata-1-0/AVT/&quot; xmlns:r=&quot;urn:schemas-rinconnetworks-com:metadata...
ğŸŒ === END UNIFIED CALLBACK NOTIFICATION ===

âŒ Unified event stream: Event routing failed - subscription not found
âœ… Subscribed to 192.168.4.46 - Sonos Connect:Amp - RINCON_5CAAFDEFEE7E01400 (192.168.4.46)
ğŸ“ CallbackAdapter: Registered subscription uuid:RINCON_5CAAFDEFEE7E01400_sub0000000225 for speaker RINCON_5CAAFDEFEE7E01400 service AVTransport
ğŸ“ Registered subscription uuid:RINCON_5CAAFDEFEE7E01400_sub0000000225 for speaker 192.168.4.46 - Sonos Connect:Amp - RINCON_5CAAFDEFEE7E01400

ğŸŒ === UNIFIED CALLBACK SERVER: INCOMING NOTIFY ===
ğŸ“¡ Method: NOTIFY
ğŸ“¡ Path: /
ğŸ“ Body size: 4068 bytes
ğŸ“‹ Headers:
   SID: uuid:RINCON_5CAAFDEFEE7E01400_sub0000000225
   NT: upnp:event
   NTS: upnp:propchange
ğŸ“„ Event XML (first 200 chars):
<e:propertyset xmlns:e="urn:schemas-upnp-org:event-1-0"><e:property><LastChange>&lt;Event xmlns=&quot;urn:schemas-upnp-org:metadata-1-0/AVT/&quot; xmlns:r=&quot;urn:schemas-rinconnetworks-com:metadata...
ğŸŒ === END UNIFIED CALLBACK NOTIFICATION ===

âŒ Unified event stream: Event routing failed - subscription not found
âš ï¸  Failed to subscribe to 192.168.4.47 - Sonos One - RINCON_7828CAFB9D9C01400 (192.168.4.47): Network error: http://192.168.4.47:1400/MediaRenderer/AVTransport/Event: status code 503
âš ï¸  Failed to subscribe to 192.168.4.48 - Sonos One - RINCON_7828CA128F0001400 (192.168.4.48): Network error: http://192.168.4.48:1400/MediaRenderer/AVTransport/Event: status code 503
âœ… Subscribed to 192.168.4.43 - Sonos Amp - RINCON_804AF2AA2FA201400 (192.168.4.43)
ğŸ“ CallbackAdapter: Registered subscription uuid:RINCON_804AF2AA2FA201400_sub0000000365 for speaker RINCON_804AF2AA2FA201400 service AVTransport
ğŸ“ Registered subscription uuid:RINCON_804AF2AA2FA201400_sub0000000365 for speaker 192.168.4.43 - Sonos Amp - RINCON_804AF2AA2FA201400
âœ… Created 6 subscription(s)

ğŸ§ Listening for events from all speakers...
ğŸ’¡ Try playing, pausing, or changing tracks on your Sonos speakers
â¹ï¸  Press Ctrl+C to stop


ğŸŒ === UNIFIED CALLBACK SERVER: INCOMING NOTIFY ===
ğŸ“¡ Method: NOTIFY
ğŸ“¡ Path: /
ğŸ“ Body size: 2133 bytes
ğŸ“‹ Headers:
   SID: uuid:RINCON_804AF2AA2FA201400_sub0000000365
   NT: upnp:event
   NTS: upnp:propchange
ğŸ“„ Event XML (first 200 chars):
<e:propertyset xmlns:e="urn:schemas-upnp-org:event-1-0"><e:property><LastChange>&lt;Event xmlns=&quot;urn:schemas-upnp-org:metadata-1-0/AVT/&quot; xmlns:r=&quot;urn:schemas-rinconnetworks-com:metadata...
ğŸŒ === END UNIFIED CALLBACK NOTIFICATION ===

âŒ Unified event stream: Event routing failed - subscription not found

ğŸŒ === UNIFIED CALLBACK SERVER: INCOMING NOTIFY ===
ğŸ“¡ Method: NOTIFY
ğŸ“¡ Path: /
ğŸ“ Body size: 2133 bytes
ğŸ“‹ Headers:
   SID: uuid:RINCON_B8E937A84F0601400_sub0000000234
   NT: upnp:event
   NTS: upnp:propchange
ğŸ“„ Event XML (first 200 chars):
<e:propertyset xmlns:e="urn:schemas-upnp-org:event-1-0"><e:property><LastChange>&lt;Event xmlns=&quot;urn:schemas-upnp-org:metadata-1-0/AVT/&quot; xmlns:r=&quot;urn:schemas-rinconnetworks-com:metadata...
ğŸŒ === END UNIFIED CALLBACK NOTIFICATION ===