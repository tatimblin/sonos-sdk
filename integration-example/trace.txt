Here's relevant output



2025-12-14T05:38:52.796168Z  INFO integration_example: Discovered 8 Sonos device(s)

2025-12-14T05:38:52.796175Z  INFO integration_example: Found device: '192.168.4.45 - Sonos Connect:Amp - RINCON_B8E937A84F0601400' (Bathroom) at 192.168.4.45 [Sonos Connect:Amp]

2025-12-14T05:38:52.796181Z  INFO integration_example: Found device: '192.168.4.39 - Sonos Roam 2 - RINCON_C43875CA135801400' (Roam / Office) at 192.168.4.39 [Sonos Roam 2]

2025-12-14T05:38:52.796187Z  INFO integration_example: Found device: '192.168.4.40 - Sonos Playbar - RINCON_5CAAFDAE58BD01400' (Basement) at 192.168.4.40 [Sonos Playbar]

2025-12-14T05:38:52.796192Z  INFO integration_example: Found device: '192.168.4.30 - Sonos One - RINCON_7828CAFB9D9C01400' (Basement) at 192.168.4.30 [Sonos One]

2025-12-14T05:38:52.796197Z  INFO integration_example: Found device: '192.168.4.102 - Sonos Connect:Amp - RINCON_5CAAFDEFEE7E01400' (Bedroom) at 192.168.4.102 [Sonos Connect:Amp]

2025-12-14T05:38:52.796203Z  INFO integration_example: Found device: '192.168.4.29 - Sonos One - RINCON_7828CA128F0001400' (Basement) at 192.168.4.29 [Sonos One]

2025-12-14T05:38:52.796207Z  INFO integration_example: Found device: '192.168.4.48 - Sonos Amp - RINCON_804AF2AA2FA201400' (Living Room) at 192.168.4.48 [Sonos Amp]

2025-12-14T05:38:52.796214Z  INFO integration_example: Found device: '192.168.4.46 - Sonos Connect:Amp - RINCON_000E583FEE3401400' (Kitchen) at 192.168.4.46 [Sonos Connect:Amp]

2025-12-14T05:38:52.796234Z  INFO integration_example: Phase 2: Selecting target device...

2025-12-14T05:38:52.796239Z  INFO integration_example: Looking for target device: 'Sonos Roam 2'

2025-12-14T05:38:52.796315Z  INFO integration_example::device_selection: Exact match not found for 'Sonos Roam 2', using partial match: '192.168.4.39 - Sonos Roam 2 - RINCON_C43875CA135801400'

2025-12-14T05:38:52.796358Z  INFO integration_example: Successfully selected device: '192.168.4.39 - Sonos Roam 2 - RINCON_C43875CA135801400' (uuid:RINCON_C43875CA135801400)

2025-12-14T05:38:52.796366Z  INFO integration_example: Selected device: '192.168.4.39 - Sonos Roam 2 - RINCON_C43875CA135801400' (Roam / Office) at 192.168.4.39

2025-12-14T05:38:52.796371Z  INFO integration_example: Phase 3: Setting up event broker...

2025-12-14T05:38:52.796386Z  INFO integration_example: Creating event broker with port range 3400-3500

2025-12-14T05:38:52.796391Z  INFO integration_example::event_broker: Initializing event broker with AVTransport strategy

2025-12-14T05:38:52.796395Z  INFO integration_example::event_broker: Broker configuration: port_range=(3400, 3500), timeout=1800s, renewal_threshold=300s, max_retries=3, buffer_size=100

2025-12-14T05:38:52.796402Z  INFO integration_example::event_broker: Created AVTransport strategy for media transport events

CallbackServer listening on 0.0.0.0:3400

2025-12-14T05:38:52.797589Z  INFO integration_example::event_broker: Event broker initialized successfully with callback server on port range (3400, 3500)

2025-12-14T05:38:52.797598Z  INFO integration_example: Event broker created successfully

2025-12-14T05:38:52.797603Z  INFO integration_example: Phase 4: Establishing AVTransport subscription...

2025-12-14T05:38:52.797608Z  INFO integration_example: Creating AVTransport subscription for device '192.168.4.39 - Sonos Roam 2 - RINCON_C43875CA135801400'

2025-12-14T05:38:52.797626Z  INFO integration_example::subscription: Creating AVTransport subscription for speaker '192.168.4.39 - Sonos Roam 2 - RINCON_C43875CA135801400' (uuid:RINCON_C43875CA135801400)

2025-12-14T05:38:52.797646Z DEBUG integration_example::subscription: Subscription config: timeout=30s, max_retries=3, retry_delay=2s

2025-12-14T05:38:52.797727Z  INFO integration_example::subscription: Subscription attempt 1 of 3 for speaker '192.168.4.39 - Sonos Roam 2 - RINCON_C43875CA135801400'

ðŸ”— Using callback URL: http://192.168.4.64:3400

2025-12-14T05:38:52.798168Z TRACE hyper::client::pool: checkout waiting for idle connection: ("http", 192.168.4.39:1400)

2025-12-14T05:38:52.798300Z DEBUG reqwest::connect: starting new connection: http://192.168.4.39:1400/

2025-12-14T05:38:52.798522Z TRACE hyper::client::connect::http: Http::connect; scheme=Some("http"), host=Some("192.168.4.39"), port=Some(Port(1400))

2025-12-14T05:38:52.798538Z DEBUG hyper::client::connect::http: connecting to 192.168.4.39:1400

2025-12-14T05:38:52.825011Z DEBUG hyper::client::connect::http: connected to 192.168.4.39:1400

2025-12-14T05:38:52.825109Z TRACE hyper::client::conn: client handshake Http1

2025-12-14T05:38:52.825139Z TRACE hyper::client::client: handshake complete, spawning background dispatcher task

2025-12-14T05:38:52.825295Z TRACE hyper::proto::h1::conn: flushed({role=client}): State { reading: Init, writing: Init, keep_alive: Busy }

2025-12-14T05:38:52.825339Z TRACE hyper::client::pool: checkout dropped for ("http", 192.168.4.39:1400)

2025-12-14T05:38:52.825473Z TRACE encode_headers: hyper::proto::h1::role: Client::encode method=SUBSCRIBE, body=None

2025-12-14T05:38:52.825554Z DEBUG hyper::proto::h1::io: flushed 169 bytes

2025-12-14T05:38:52.825560Z TRACE hyper::proto::h1::conn: flushed({role=client}): State { reading: Init, writing: KeepAlive, keep_alive: Busy }

2025-12-14T05:38:52.838259Z TRACE hyper::proto::h1::conn: Conn::read_head

2025-12-14T05:38:52.838314Z TRACE hyper::proto::h1::io: received 159 bytes

2025-12-14T05:38:52.838376Z TRACE parse_headers: hyper::proto::h1::role: Response.parse bytes=159

2025-12-14T05:38:52.838403Z TRACE parse_headers: hyper::proto::h1::role: Response.parse Complete(159)

2025-12-14T05:38:52.838444Z TRACE parse_headers: hyper::proto::h1::role: neither Transfer-Encoding nor Content-Length

2025-12-14T05:38:52.838470Z DEBUG hyper::proto::h1::io: parsed 4 headers

2025-12-14T05:38:52.838480Z DEBUG hyper::proto::h1::conn: incoming body is close-delimited

2025-12-14T05:38:52.838485Z TRACE hyper::proto::h1::conn: remote disabling keep-alive

2025-12-14T05:38:52.838515Z TRACE hyper::proto::h1::decode: decode; state=Eof(false)

2025-12-14T05:38:52.838531Z TRACE hyper::proto::h1::conn: flushed({role=client}): State { reading: Body(Eof(false)), writing: KeepAlive, keep_alive: Disabled }

2025-12-14T05:38:52.838632Z TRACE hyper::proto::h1::dispatch: body receiver dropped before eof, draining or closing

2025-12-14T05:38:52.838640Z TRACE hyper::proto::h1::decode: decode; state=Eof(false)

2025-12-14T05:38:52.838647Z TRACE hyper::proto::h1::conn: State::close_read()

2025-12-14T05:38:52.838656Z TRACE hyper::proto::h1::conn: State::close()

2025-12-14T05:38:52.838656Z DEBUG integration_example::subscription: Subscription request sent successfully for speaker '192.168.4.39 - Sonos Roam 2 - RINCON_C43875CA135801400'

2025-12-14T05:38:52.838661Z TRACE hyper::proto::h1::conn: flushed({role=client}): State { reading: Closed, writing: Closed, keep_alive: Disabled }

2025-12-14T05:38:52.838665Z  INFO integration_example::subscription: Successfully created AVTransport subscription for speaker '192.168.4.39 - Sonos Roam 2 - RINCON_C43875CA135801400' on attempt 1

2025-12-14T05:38:52.838677Z  INFO integration_example: AVTransport subscription established successfully

2025-12-14T05:38:52.838685Z  INFO integration_example: Subscription established successfully

2025-12-14T05:38:52.838690Z  INFO integration_example: Phase 5: Starting event stream consumption...

2025-12-14T05:38:52.838695Z  INFO integration_example: Starting event stream consumption

2025-12-14T05:38:52.838696Z TRACE hyper::proto::h1::conn: shut down IO complete

=== Event Stream Started ===

Listening for AVTransport events... (Press Ctrl+C to stop)

2025-12-14T05:38:52.838720Z  INFO integration_example::event_processing: Starting event stream consumer

2025-12-14T05:38:52.838749Z  INFO integration_example::event_processing: Subscription established speaker_id=uuid:RINCON_C43875CA135801400 service_type=AVTransport subscription_id=uuid:RINCON_C43875CA135801400_sub0000000192

[2025-12-13 21:38:52.838] SUBSCRIPTION_ESTABLISHED: AVTransport on uuid:RINCON_C43875CA135801400 (uuid:RINCON_C43875CA135801400_sub0000000192)

2025-12-14T05:38:52.863654Z TRACE hyper::proto::h1::conn: Conn::read_head

2025-12-14T05:38:52.863729Z TRACE hyper::proto::h1::conn: flushed({role=server}): State { reading: Init, writing: Init, keep_alive: Busy }

2025-12-14T05:38:52.863805Z TRACE hyper::proto::h1::conn: Conn::read_head

2025-12-14T05:38:52.863822Z TRACE hyper::proto::h1::io: received 1448 bytes

2025-12-14T05:38:52.863952Z TRACE parse_headers: hyper::proto::h1::role: Request.parse bytes=1448

2025-12-14T05:38:52.863995Z TRACE parse_headers: hyper::proto::h1::role: Request.parse Complete(241)

2025-12-14T05:38:52.864047Z DEBUG hyper::proto::h1::io: parsed 9 headers

2025-12-14T05:38:52.864053Z DEBUG hyper::proto::h1::conn: incoming body is content-length (2211 bytes)

2025-12-14T05:38:52.864058Z TRACE hyper::proto::h1::conn: remote disabling keep-alive

2025-12-14T05:38:52.864095Z TRACE hyper::proto::h1::decode: decode; state=Length(2211)

2025-12-14T05:38:52.864116Z TRACE warp::filters::path: "notify"?: ""

2025-12-14T05:38:52.864151Z TRACE encode_headers: hyper::proto::h1::role: Server::encode status=404, body=Some(Known(22)), req_method=Some(NOTIFY)

2025-12-14T05:38:52.864203Z TRACE hyper::proto::h1::io: buffer.queue self.len=124 buf.len=22

2025-12-14T05:38:52.864246Z DEBUG hyper::proto::h1::io: flushed 146 bytes

2025-12-14T05:38:52.864251Z TRACE hyper::proto::h1::conn: flushed({role=server}): State { reading: Body(Length(1004)), writing: Closed, keep_alive: Disabled }

2025-12-14T05:38:52.864273Z TRACE hyper::proto::h1::dispatch: body receiver dropped before eof, draining or closing

2025-12-14T05:38:52.864278Z TRACE hyper::proto::h1::decode: decode; state=Length(1004)

2025-12-14T05:38:52.864284Z TRACE hyper::proto::h1::conn: State::close_read()

2025-12-14T05:38:52.864292Z TRACE hyper::proto::h1::conn: flushed({role=server}): State { reading: Closed, writing: Closed, keep_alive: Disabled }

2025-12-14T05:38:52.864317Z TRACE hyper::proto::h1::conn: shut down IO complete

2025-12-14T05:38:56.947616Z TRACE hyper::proto::h1::conn: Conn::read_head

2025-12-14T05:38:56.947743Z TRACE hyper::proto::h1::conn: flushed({role=server}): State { reading: Init, writing: Init, keep_alive: Busy }

2025-12-14T05:38:56.947855Z TRACE hyper::proto::h1::conn: Conn::read_head

2025-12-14T05:38:56.947899Z TRACE hyper::proto::h1::io: received 1448 bytes

2025-12-14T05:38:56.948017Z TRACE parse_headers: hyper::proto::h1::role: Request.parse bytes=1448

2025-12-14T05:38:56.948113Z TRACE parse_headers: hyper::proto::h1::role: Request.parse Complete(241)

2025-12-14T05:38:56.948296Z DEBUG hyper::proto::h1::io: parsed 9 headers

2025-12-14T05:38:56.948321Z DEBUG hyper::proto::h1::conn: incoming body is content-length (2211 bytes)

2025-12-14T05:38:56.948353Z TRACE hyper::proto::h1::conn: remote disabling keep-alive

2025-12-14T05:38:56.948448Z TRACE hyper::proto::h1::decode: decode; state=Length(2211)

2025-12-14T05:38:56.948513Z TRACE warp::filters::path: "notify"?: ""

2025-12-14T05:38:56.948619Z TRACE encode_headers: hyper::proto::h1::role: Server::encode status=404, body=Some(Known(22)), req_method=Some(NOTIFY)

2025-12-14T05:38:56.948705Z TRACE hyper::proto::h1::io: buffer.queue self.len=124 buf.len=22

2025-12-14T05:38:56.948835Z DEBUG hyper::proto::h1::io: flushed 146 bytes

2025-12-14T05:38:56.948852Z TRACE hyper::proto::h1::conn: flushed({role=server}): State { reading: Body(Length(1004)), writing: Closed, keep_alive: Disabled }

2025-12-14T05:38:56.948943Z TRACE hyper::proto::h1::dispatch: body receiver dropped before eof, draining or closing

2025-12-14T05:38:56.948964Z TRACE hyper::proto::h1::decode: decode; state=Length(1004)

2025-12-14T05:38:56.948983Z TRACE hyper::proto::h1::conn: State::close_read()

2025-12-14T05:38:56.949012Z TRACE hyper::proto::h1::conn: flushed({role=server}): State { reading: Closed, writing: Closed, keep_alive: Disabled }

2025-12-14T05:38:56.949079Z TRACE hyper::proto::h1::conn: shut down IO complete

2025-12-14T05:39:05.033707Z TRACE hyper::proto::h1::conn: Conn::read_head

2025-12-14T05:39:05.033777Z TRACE hyper::proto::h1::conn: flushed({role=server}): State { reading: Init, writing: Init, keep_alive: Busy }

2025-12-14T05:39:05.033862Z TRACE hyper::proto::h1::conn: Conn::read_head

2025-12-14T05:39:05.033895Z TRACE hyper::proto::h1::io: received 2452 bytes

2025-12-14T05:39:05.033956Z TRACE parse_headers: hyper::proto::h1::role: Request.parse bytes=2452

2025-12-14T05:39:05.034026Z TRACE parse_headers: hyper::proto::h1::role: Request.parse Complete(241)

2025-12-14T05:39:05.034143Z DEBUG hyper::proto::h1::io: parsed 9 headers

2025-12-14T05:39:05.034161Z DEBUG hyper::proto::h1::conn: incoming body is content-length (2211 bytes)

2025-12-14T05:39:05.034179Z TRACE hyper::proto::h1::conn: remote disabling keep-alive

2025-12-14T05:39:05.034221Z TRACE hyper::proto::h1::decode: decode; state=Length(2211)

2025-12-14T05:39:05.034240Z DEBUG hyper::proto::h1::conn: incoming body completed

2025-12-14T05:39:05.034282Z TRACE warp::filters::path: "notify"?: ""

2025-12-14T05:39:05.034377Z TRACE encode_headers: hyper::proto::h1::role: Server::encode status=404, body=Some(Known(22)), req_method=Some(NOTIFY)

2025-12-14T05:39:05.034439Z TRACE hyper::proto::h1::io: buffer.queue self.len=124 buf.len=22

2025-12-14T05:39:05.034556Z DEBUG hyper::proto::h1::io: flushed 146 bytes

2025-12-14T05:39:05.034573Z TRACE hyper::proto::h1::conn: State::close()

2025-12-14T05:39:05.034584Z TRACE hyper::proto::h1::conn: flushed({role=server}): State { reading: Closed, writing: Closed, keep_alive: Disabled }

2025-12-14T05:39:05.034639Z TRACE hyper::proto::h1::conn: shut down IO complete

^C2025-12-14T05:39:12.239409Z  INFO integration_example::event_processing: Received shutdown signal, stopping event consumer

=== Event Processing Statistics ===

Total events processed: 1

Subscriptions established: 1

Subscriptions failed: 0

Service events: 0

Parse errors: 0

Subscription renewals: 0

Subscription expirations: 0

Subscription removals: 0

2025-12-14T05:39:12.239510Z  INFO integration_example::event_processing: Event processing completed: Events: 1 total, 0 service, 1 established, 0 failed, 0 errors

2025-12-14T05:39:12.239555Z  INFO integration_example: Phase 6: Cleaning up resources...

2025-12-14T05:39:12.239644Z  INFO integration_example: Cleaning up resources...

2025-12-14T05:39:12.239690Z  INFO integration_example::subscription: Unsubscribing from AVTransport service for speaker '192.168.4.39 - Sonos Roam 2 - RINCON_C43875CA135801400' (uuid:RINCON_C43875CA135801400)

2025-12-14T05:39:12.240557Z TRACE hyper::client::pool: checkout waiting for idle connection: ("http", 192.168.4.39:1400)

2025-12-14T05:39:12.240647Z DEBUG reqwest::connect: starting new connection: http://192.168.4.39:1400/

2025-12-14T05:39:12.240713Z TRACE hyper::client::connect::http: Http::connect; scheme=Some("http"), host=Some("192.168.4.39"), port=Some(Port(1400))

2025-12-14T05:39:12.240766Z DEBUG hyper::client::connect::http: connecting to 192.168.4.39:1400

2025-12-14T05:39:12.257481Z DEBUG hyper::client::connect::http: connected to 192.168.4.39:1400

2025-12-14T05:39:12.257680Z TRACE hyper::client::conn: client handshake Http1

2025-12-14T05:39:12.257738Z TRACE hyper::client::client: handshake complete, spawning background dispatcher task

2025-12-14T05:39:12.257924Z TRACE hyper::proto::h1::conn: flushed({role=client}): State { reading: Init, writing: Init, keep_alive: Busy }

2025-12-14T05:39:12.257955Z TRACE hyper::client::pool: checkout dropped for ("http", 192.168.4.39:1400)

2025-12-14T05:39:12.258230Z TRACE encode_headers: hyper::proto::h1::role: Client::encode method=UNSUBSCRIBE, body=None

2025-12-14T05:39:12.258517Z DEBUG hyper::proto::h1::io: flushed 145 bytes

2025-12-14T05:39:12.258536Z TRACE hyper::proto::h1::conn: flushed({role=client}): State { reading: Init, writing: KeepAlive, keep_alive: Busy }

2025-12-14T05:39:12.273015Z TRACE hyper::proto::h1::conn: Conn::read_head

2025-12-14T05:39:12.273109Z TRACE hyper::proto::h1::io: received 87 bytes

2025-12-14T05:39:12.273186Z TRACE parse_headers: hyper::proto::h1::role: Response.parse bytes=87

2025-12-14T05:39:12.273248Z TRACE parse_headers: hyper::proto::h1::role: Response.parse Complete(87)

2025-12-14T05:39:12.273327Z TRACE parse_headers: hyper::proto::h1::role: neither Transfer-Encoding nor Content-Length

2025-12-14T05:39:12.273398Z DEBUG hyper::proto::h1::io: parsed 2 headers

2025-12-14T05:39:12.273444Z DEBUG hyper::proto::h1::conn: incoming body is close-delimited

2025-12-14T05:39:12.273463Z TRACE hyper::proto::h1::conn: remote disabling keep-alive

2025-12-14T05:39:12.273536Z TRACE hyper::proto::h1::decode: decode; state=Eof(false)

2025-12-14T05:39:12.273579Z TRACE hyper::proto::h1::conn: flushed({role=client}): State { reading: Body(Eof(false)), writing: KeepAlive, keep_alive: Disabled }

2025-12-14T05:39:12.273686Z TRACE hyper::proto::h1::dispatch: body receiver dropped before eof, draining or closing

2025-12-14T05:39:12.273706Z TRACE hyper::proto::h1::decode: decode; state=Eof(false)

2025-12-14T05:39:12.273726Z TRACE hyper::proto::h1::io: received 0 bytes

2025-12-14T05:39:12.273724Z  INFO integration_example::subscription: Successfully unsubscribed from AVTransport service for speaker '192.168.4.39 - Sonos Roam 2 - RINCON_C43875CA135801400'

2025-12-14T05:39:12.273742Z DEBUG hyper::proto::h1::conn: incoming body completed

2025-12-14T05:39:12.273760Z  INFO integration_example: Resource cleanup completed

2025-12-14T05:39:12.273761Z TRACE hyper::proto::h1::conn: try_keep_alive({role=client}): could keep-alive, but status = Disabled

2025-12-14T05:39:12.273776Z  INFO integration_example: Shutting down event broker...

2025-12-14T05:39:12.273780Z TRACE hyper::proto::h1::conn: State::close()

2025-12-14T05:39:12.273804Z TRACE hyper::proto::h1::conn: State::close_read()

2025-12-14T05:39:12.273832Z TRACE hyper::proto::h1::conn: flushed({role=client}): State { reading: Closed, writing: Closed, keep_alive: Disabled }

2025-12-14T05:39:12.273890Z TRACE hyper::proto::h1::conn: shut down IO complete

2025-12-14T05:39:12.274109Z DEBUG hyper::server::shutdown: signal received, starting graceful shutdown

2025-12-14T05:39:12.274255Z  INFO integration_example: Integration workflow completed successfully

2025-12-14T05:39:12.274281Z  INFO integration_example: Integration example completed successfully